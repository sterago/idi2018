image: sterago/idi2018

before_script:
  - python -V

install backend dependencies:
  stage: install
  script:
  - echo "installing backend dependencies"

install frontend dependencies:
  stage: install
  script:
  - echo "installing frontend dependencies"

build frontend assets:
  stage: build
  script:
  - echo "building frontend assets"

unit tests:
  stage: unit and integration tests
  script:
  - echo "unit tests ran"

integration tests:
  stage: unit and integration tests
  script:
  - echo "integration tests ran"

visual tests:
  stage: visual tests
  variables:
    SELENIUM_HUB: 'selenium-grid'
  script:
  - RUNNER_IP=`hostname -I` pytest --driver Remote --capability browserName chrome --host ${SELENIUM_HUB} --needle-engine perceptualdiff test_homepage.py
  artifacts:
      paths:
      - screenshots/
      when: always

deploy:
  stage: deploy
  script:
  - echo "deploy"

stages:
  - install
  - build
  - unit and integration tests
  - visual tests
  - deploy